REAPER C/C++ extension plug-in mini-SDK
======================================

## Prerequisites

* [WDL](https://github.com/justinfrankel/WDL) checked out next to this repository (`WDL/`). Fetch it with a deterministic step such as:

  ```sh
  git submodule add https://github.com/justinfrankel/WDL.git WDL
  # or
  git clone https://github.com/justinfrankel/WDL.git WDL
  ```

  The CMake build requires the `WDL` directory to be present before configuration.
* A C/C++ compiler – Visual Studio 2019 or newer on Windows, GCC/Clang
  (MinGW-w64) on Windows, the Xcode command line tools on macOS, or
  GCC/Clang 9+ on Linux.
* Environment variables pointing at the sources:
* `ORPHEUS_SDK` – path to this repository.
* `WDL_PATH` – path to the WDL checkout (defaults to `$ORPHEUS_SDK/WDL`).

The headers live in `sdk/` and sample plug-ins live in
`reaper-plugins/` (these plug-ins ship with REAPER and are useful as
references but are not necessarily good design examples).

## Building

### CMake (Windows, macOS, Linux)

The included cross-platform CMake build can produce the sample plug-ins
and example library on all supported platforms. After fetching the WDL
submodule, configure and build:

```sh
cmake -S . -B build
cmake --build build
```

The plug-in binaries will be emitted to `build/plugins/`.

To build only certain plug-ins, toggle the available options at
configure time. For example, build just the control surface plug-in:

```sh
cmake -S . -B build -DBUILD_REAPER_CSURF=ON -DBUILD_REAPER_ATMOS=OFF -DBUILD_REAPER_MP3=OFF -DBUILD_REAPER_STT=OFF
cmake --build build
```

On Windows, specify a generator and configuration:

```bat
cmake -S . -B build -G "Visual Studio 17 2022"
cmake --build build --config Release
```

On macOS and Linux, the default generator suffices:

```sh
cmake -S . -B build
cmake --build build
```

This workflow has been verified with Visual Studio on Windows, Xcode on
macOS, and GCC/Clang on Linux.

### Windows (Visual Studio)

1. Open a "x64 Native Tools" command prompt.
2. Set environment variables:

   ```bat
   set ORPHEUS_SDK=C:\path\to\orpheus-sdk
   set WDL_PATH=%ORPHEUS_SDK%\WDL
   ```

3. Build the sample control surface plug-in:

   ```bat
   msbuild %ORPHEUS_SDK%\reaper-plugins\reaper_csurf\reaper_csurf.vcxproj /p:Configuration=Release
   ```

The resulting `reaper_csurf.dll` will be in the project's `Release`
folder.

### Windows (MinGW-w64 GCC/Clang)

1. Install a MinGW-w64 toolchain (for example via MSYS2 or the
   `mingw-w64` packages).
2. Set environment variables:

   ```sh
   export ORPHEUS_SDK="/path/to/orpheus-sdk"
   export WDL_PATH="$ORPHEUS_SDK/WDL"
   ```

3. Build the sample control surface plug-in:

   ```sh
   x86_64-w64-mingw32-g++ -shared -std=c++11 -I"$ORPHEUS_SDK/sdk" -I"$WDL_PATH" \
     reaper-plugins/reaper_csurf/csurf_main.cpp \
     reaper-plugins/reaper_csurf/*.cpp \
     -lws2_32 \
     -o reaper_csurf.dll
   ```

The resulting `reaper_csurf.dll` will be in the current directory.

### macOS (clang)

1. Install the Xcode command line tools.
2. Set environment variables:

   ```sh
   export ORPHEUS_SDK="$HOME/projects/orpheus-sdk"
   export WDL_PATH="$ORPHEUS_SDK/WDL"
   ```

3. Generate macOS resource files for any plug-in that includes a
   `res.rc`:

   ```sh
   "$WDL_PATH/WDL/swell/swell_dlggen" reaper-plugins/reaper_csurf/res.rc
   "$WDL_PATH/WDL/swell/swell_menu"   reaper-plugins/reaper_csurf/res.rc
   # or run all generators at once
   ./scripts/gen_mac_resources.sh
   ```
   These commands produce `res.rc_mac_dlg` and `res.rc_mac_menu`
   alongside the original `res.rc` and must be run whenever the
   resources change.

4. Build the sample plug-in (universal binary):

   ```sh
   clang++ -dynamiclib -std=c++11 -arch x86_64 -arch arm64 \
     -I"$ORPHEUS_SDK/sdk" -I"$WDL_PATH" \
     reaper-plugins/reaper_csurf/csurf_main.cpp \
     reaper-plugins/reaper_csurf/*.cpp \
     -framework Cocoa \
     -o reaper_csurf.dylib
   ```
   Other frameworks may be required depending on the plug-in. On macOS
   10.15 and later, the resulting binary must be codesigned and
   notarized if distributed:

   ```sh
   codesign --force --deep --sign - reaper_csurf.dylib
   xcrun notarytool submit --wait reaper_csurf.dylib
   ```

### Linux (gcc/clang)

1. Install GCC or Clang and make.
2. Set the same environment variables as for macOS.
3. Build the sample plug-in:

   ```sh
   g++ -shared -fPIC -std=c++11 -I"$ORPHEUS_SDK/sdk" -I"$WDL_PATH" \
     reaper-plugins/reaper_csurf/csurf_main.cpp \
     reaper-plugins/reaper_csurf/*.cpp \
     -o reaper_csurf.so
   ```

## Loading the plug-in in REAPER

Copy the resulting binary into REAPER's `UserPlugins` directory:

* **Windows:** `%APPDATA%\REAPER\UserPlugins`
* **macOS:** `~/Library/Application Support/REAPER/UserPlugins`
* **Linux:** `~/.config/REAPER/UserPlugins`

Restart REAPER and the plug-in should appear under the "Extensions"
menu.

### Verifying the plug-in entry point

Confirm that the binary exports `REAPER_PLUGIN_ENTRYPOINT` before
loading it:

* **Windows:**

  ```bat
  dumpbin /exports reaper_csurf.dll | findstr REAPER_PLUGIN_ENTRYPOINT
  ```

* **macOS/Linux:**

  ```sh
  nm -g reaper_csurf.{dylib,so} | grep REAPER_PLUGIN_ENTRYPOINT
  ```

If the symbol is present, REAPER will load the plug-in.
